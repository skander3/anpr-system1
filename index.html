<!DOCTYPE html>
<html>
<head>
    <script>
// Vérifier mot de passe
function checkPassword() {
    const password = prompt("Entrez le mot de passe admin:");
    if (password === "skander123") {
        document.getElementById("admin-interface").style.display = "block";
    } else {
        alert("Accès refusé");
        window.location.href = "about:blank";
    }
}
// Appeler au chargement
checkPassword();
</script>
    <title>إدارة لوحات السيارات</title>
    <meta charset="utf-8">
    <style>
        body {
      background-color: #e7eddffe; /* غيّر هوني للون اللي تحب (hex) */
      color: rgb(22, 1, 1);              /* لون النص العام في الصفحة */
      font-family: Arial, sans-serif;
    }
        .section { border: 1px solid #160202; padding: 20px; margin: 20px 0; }
        input, button { padding: 8px; margin: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
        th { background-color: #eaf5f2; }
        .delete { color: rgb(162, 81, 81); cursor: pointer; }
    </style>
</head>
<body>
    <h1>🚗 إدارة لوحات السيارات المسموح لها</h1>

    <!-- قسم الإضافة -->
    <div class="section" style="background-color: #abe5ed;">
        <h2>➕ إضافة لوحة جديدة</h2>
        <input type="text" id="plateNumber" placeholder="أدخل رقم اللوحة (مثال: 154 Tunis 1234)" style="width: 300px;">
        <input type="text" id="ownerName" placeholder="اسم المالك" style="width: 200px;">
        <button onclick="addPlate()">إضافة</button>
    </div>

    <!-- قسم العرض -->
    <div class="section" style="background-color: #abe5ed;">
        <h2>📋 اللوحات المسجلة</h2>
        <table id="platesTable">
            <thead>
                <tr>
                    <th>رقم اللوحة</th>
                    <th>اسم المالك</th>
                    <th>حذف</th>
                </tr>
            </thead>
            <tbody id="platesBody">
                <!-- هنا تظهر اللوحات -->
            </tbody>
        </table>
    </div>

    <script>
        // دالة لجلب اللوحات من الذاكرة
        function getPlates() {
            const plates = localStorage.getItem('carPlates');
            return plates ? JSON.parse(plates) : [];
        }

        // دالة لحفظ اللوحات في الذاكرة
        function savePlates(plates) {
            localStorage.setItem('carPlates', JSON.stringify(plates));
        }

        // دالة إضافة لوحة جديدة
        function addPlate() {
            const plateNumber = document.getElementById('plateNumber').value;
            const ownerName = document.getElementById('ownerName').value;

            if (!plateNumber) {
                alert('الرجاء إدخال رقم اللوحة');
                return;
            }

            const plates = getPlates();
            plates.push({
                plate_number: plateNumber,
                owner_name: ownerName,
                date_added: new Date().toLocaleDateString('ar-TN')
            });

            savePlates(plates);
            displayPlates();
            
            // إفراغ الحقول بعد الإضافة
            document.getElementById('plateNumber').value = '';
            document.getElementById('ownerName').value = '';
            
            alert('تم إضافة اللوحة بنجاح!');
        }

        // دالة عرض اللوحات
        function displayPlates() {
            const plates = getPlates();
            const platesBody = document.getElementById('platesBody');
            
            platesBody.innerHTML = '';

            if (plates.length === 0) {
                platesBody.innerHTML = '<tr><td colspan="3" style="text-align: center;">لا توجد لوحات مسجلة</td></tr>';
                return;
            }

            plates.forEach((plate, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${plate.plate_number}</td>
                    <td>${plate.owner_name || '-'}</td>
                    <td><span class="delete" onclick="deletePlate(${index})">🗑️ حذف</span></td>
                `;
                platesBody.appendChild(row);
            });
        }

        // دالة حذف لوحة
        function deletePlate(index) {
            if (confirm('هل أنت متأكد من الحذف؟')) {
                const plates = getPlates();
                plates.splice(index, 1);
                savePlates(plates);
                displayPlates();
                alert('تم الحذف بنجاح!');
            }
        }

        // عرض اللوحات عند تحميل الصفحة
        displayPlates();
    </script>

    <!-- قسم لمحاكاة عمل ESP32 -->
    <div class="section" style="background-color: #abe5ed;">
        <h2>🔧 محاكاة عمل النظام</h2>
        <p>لاختبار النظام، أدخل رقم لوحة لترى إذا كانت مسجلة:</p>
        <input type="text" id="testPlate" placeholder="أدخل رقم لوحة للاختبار" style="width: 300px;">
        <button onclick="testPlate()">فحص اللوحة</button>
        <p id="testResult" style="margin-top: 10px; font-weight: bold;"></p>
    </div>

    <script>
        // دالة فحص اللوحة (محاكاة لعمل ESP32)
        function testPlate() {
            const testPlate = document.getElementById('testPlate').value;
            const plates = getPlates();
            const resultElement = document.getElementById('testResult');
            
            const found = plates.find(plate => plate.plate_number === testPlate);
            
            if (found) {
                resultElement.innerHTML = `✅ مسموح بالدخول - مالك السيارة: ${found.owner_name || 'غير معروف'}`;
                resultElement.style.color = 'green';
            } else {
                resultElement.innerHTML = '❌ ممنوع الدخول - اللوحة غير مسجلة';
                resultElement.style.color = 'red';
            }
        }
    </script>
</body>

</html>

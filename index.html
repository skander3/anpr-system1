<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ferme Ajeb - Plates Manager</title>
  <style>
    body { font-family: Arial; max-width:800px; margin:20px auto; padding:10px; }
    input, button, select { padding:8px; font-size:16px; margin:2px; }
    #platesList { margin-top:20px; }
    .plate { display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; }
  </style>
</head>
<body>
  <h2>إدارة لوحات السيارات</h2>

  <form id="plateForm">
    <input id="plateInput" placeholder="أدخل اللوحة مثال TN-1234" required>
    <input id="ownerInput" placeholder="مالك السيارة (اختياري)">
    <button type="submit">حفظ</button>
  </form>

  <div id="msg"></div>

  <div id="platesList">
    <h3>قائمة اللوحات</h3>
    <div id="list"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // ---- ضع هنا firebaseConfig الخاص بك ----
    const firebaseConfig = {
      apiKey: "AIzaSyCZBzKpX75WWtsvxgH8CP3SsjdJ6Zq8Le4",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://project01-13a17-default-rtdb.firebaseio.com/",
      projectId: "project01-13a17"
    };
    // ----------------------------------------

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const plateForm = document.getElementById('plateForm');
    const plateInput = document.getElementById('plateInput');
    const ownerInput = document.getElementById('ownerInput');
    const msg = document.getElementById('msg');
    const listEl = document.getElementById('list');

    function sanitizeKey(p) {
      return p.replace(/[.#$[\]]/g, '_').trim();
    }

    async function addPlate(plate, owner="") {
      const key = sanitizeKey(plate);
      const pRef = ref(db, `plates/${key}`);
      const payload = { plate: plate, owner: owner, addedAt: Date.now() };
      try {
        await set(pRef, payload);
        showMsg('تمت الإضافة: ' + plate, 'green');
        plateInput.value = '';
        ownerInput.value = '';
      } catch(e) {
        console.error(e);
        showMsg('خطأ في الحفظ', 'red');
      }
    }

    async function deletePlate(key) {
      const pRef = ref(db, `plates/${key}`);
      try {
        await remove(pRef);
        showMsg('تم الحذف', 'green');
      } catch(e) {
        console.error(e);
        showMsg('خطأ في الحذف', 'red');
      }
    }

    function showMsg(text, color='black') {
      msg.textContent = text;
      msg.style.color = color;
      setTimeout(()=> msg.textContent = '', 3000);
    }

    plateForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const plate = plateInput.value.trim();
      const owner = ownerInput.value.trim();
      if(!plate) return showMsg('عطينا لوحة صحيحة', 'orange');
      addPlate(plate, owner);
    });

    const platesRef = ref(db, 'plates');
    onValue(platesRef, (snapshot) => {
      const data = snapshot.val() || {};
      listEl.innerHTML = '';
      const keys = Object.keys(data).sort();
      if(keys.length === 0) listEl.innerHTML = '<i>لا توجد لوحات</i>';
      keys.forEach(k => {
        const item = data[k];
        const div = document.createElement('div');
        div.className = 'plate';
        div.innerHTML = `<div><strong>${item.plate}</strong> ${item.owner || ''}</div>
                         <div><button data-key="${k}" class="delBtn">حذف</button></div>`;
        listEl.appendChild(div);
      });
      document.querySelectorAll('.delBtn').forEach(b => {
        b.onclick = () => {
          const key = b.getAttribute('data-key');
          if(confirm('تأكّد الحذف؟')) deletePlate(key);
        };
      });
    });

  </script>
</body>
</html>




